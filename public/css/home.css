@import url("styles.css");

/* --- 1. LAYOUT GERAL --- */
.layout-home {
  display: flex;
  flex-direction: column;
  height: 100vh;
  position: relative;
  overflow: hidden;
}

.main-content-wrapper {
  display: flex;
  flex: 1; /* Ocupa todo o espaço vertical restante */
  position: relative; /* Importante para o composer */
  overflow: hidden; /* Evita barras de rolagem duplas */
}

/* --- 2. ÁREA PRINCIPAL E CHAT --- */
.home-main {
  flex: 1; /* Ocupa o espaço horizontal restante */
  display: flex;
  flex-direction: column;
  /* min-height: 100vh; */
  position: relative;
}

.chat-header {
  padding: 16px;
  background: var(--bg);
  display: flex;
  align-items: center;
  flex-shrink: 0; /* Impede que o header encolha */
}

.home-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  position: relative;
  padding-bottom: 100px; /* Reserva espaço para o Composer fixo */

  min-height: 0;
}

/* Mensagens */
.messages {
  list-style: none;
  display: grid;
  gap: 12px;
  padding: 16px;
  flex: 1;
  margin-bottom: 0;
  width: 100%;
  max-width: 800px; 
  margin: 0 auto;  
  box-sizing: border-box;
  overflow-y: auto;
}

/* .msg {
  max-width: 80%;
  padding: 12px 14px;
  border-radius: 14px;
  line-height: 1.4;
}

.msg.user {
  background: #173055;
  justify-self: end; 
}

.msg.bot {
  background: #0f243f;
  justify-self: start; 
} */

.msg {
  max-width: 80%; /* A largura máxima do bloco todo */
  line-height: 1.4;
  display: flex; /* Usa flexbox... */
  flex-direction: column; /* ...para empilhar os filhos verticalmente */
}

/* Alinhamento para o USUÁRIO */
.msg.user {
  justify-self: end; /* Alinha o <li> à direita do grid */
  align-items: flex-end; /* Alinha o conteúdo (bolha, meta) à direita */
}

/* Alinhamento para o BOT */
.msg.bot {
  justify-self: start; /* Alinha o <li> à esquerda do grid */
  align-items: flex-start; /* Alinha o conteúdo (bolha, feedback, meta) à esquerda */
}

/* A "BOLHA" DE TEXTO (o primeiro <div> dentro do <li>) */
li.msg > div:first-child {
  padding: 12px 14px;
  border-radius: 14px;
}

/* Cor de fundo da bolha do USUÁRIO */
.msg.user > div:first-child {
  background: #173055;
}

/* Cor de fundo da bolha do BOT */
.msg.bot > div:first-child {
  background: #0f243f;
}

/* --- 3. COMPOSER (Formulário de Input) --- */
.composer {
  /* Layout interno (mantido) */
  height: 56px;
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  background: var(--card);
  border-radius: 36px;
  padding: 8px 8px 8px 16px;
  box-sizing: border-box;
  z-index: 100;
  transition: all var(--transition);
  gap: 8px;

  /* --- LÓGICA DE POSIÇÃO CORRIGIDA --- */
  
  /* 1. Largura Padrão */
  width: 100%;
  max-width: 300px;
  
  /* 2. Posição Padrão (Fixo embaixo) */
  position: fixed;
  bottom: 20px;
}

/* COMPORTAMENTO: TELA VAZIA (Move para o meio vertical) */
.home-container:has(.messages:empty) .composer {
  position: absolute;
  top: 50%;
  bottom: auto; /* Reseta o 'bottom: 20px' */
  transform: translate(-50%, -50%); /* Centraliza X e Y */
}

/* COMPORTAMENTO: COM MENSAGENS (Mantém embaixo) */
.home-container:has(.messages:not(:empty)) .composer {
  position: fixed;
  top: auto; /* Garante que 'top: 50%' não vaze */
  bottom: 20px;
  transform: translateX(-50%); /* Centraliza só X */
}

/* AJUSTE PARA SIDEBAR EXPANDIDA (Desktop) */
.sidebar:not(.collapsed) ~ .home-main .composer {
  /* left: calc(210px + (100% - 210px) / 2);  */
  left: 50%;
  transform: translateX(-50%);
  margin-left: 45px; 
  width: 100%;
  max-width: 800px;
}
.sidebar:not(.collapsed) ~ .home-main .messages {
  /* left: calc(210px + (100% - 210px) / 2);  */
  margin-left: auto;
  margin-right: auto;
} 

/* AJUSTE PARA SIDEBAR RECOLHIDA (Desktop) */
.sidebar.collapsed ~ .home-main .composer {
  /* left: calc(70px + (100% - 70px) / 2); */
  left: 50%;
  transform: translateX(-50%);
  margin-left: 45px; /* Metade de 90px */
  width: 100%;
  max-width: 800px;
}
.sidebar.collapsed ~ .home-main .messages {
  /* left: calc(70px + (100% - 70px) / 2); */
  margin-left: auto;
  margin-right: auto;
}

/* Faz o input ser transparente e se misturar */
#inputMsg {
  background: none;
  border: none;
  outline: none;
  color: var(--text);
  width: 100%;
  font-size: 1rem;
  line-height: 1;
  padding: 12px 0; /* Espaçamento vertical interno */
}
#inputMsg::placeholder {
  color: var(--muted);
}

/* Estiliza o botão de enviar como um ícone */
#btnSend {
  background: var(--card-light);
  color: var(--muted);
  border: none;
  border-radius: 36px;
  align-items: center;
  justify-content: center;
  
  
  /*color: var(--primary);*/ /* Cor de destaque para o ícone */
  font-size: 1.1rem;
  padding: 12px 16px; /* Área de clique confortável */
  cursor: pointer;
  transition: color var(--transition), background var(--transition);
  margin-left: 8px;
  transform: translate(4px, -3px);
}

#btnSend:not(:disabled):hover {
  background: var(--accent); /* Muda a cor no hover */
  transition: background var(--transition);
}


.home-container:has(.messages:empty) .composer {
  /* Adiciona um empurrão para baixo (só no desktop) */
  margin-top: 40px;
}

/* --- 4. SIDEBAR: ESTRUTURA PRINCIPAL --- */
.sidebar {
  width: 210px;
  background: var(--bg);
  color: var(--text);
  display: flex;
  flex-direction: column;
  /* border-right: 1.5px solid #1b2639; */
  transition: width var(--transition);
  overflow: hidden;
  flex-shrink: 0;
}

.sidebar-header {
  padding: 8px;
  /* border-bottom: 1px solid #273453; */
  display: flex;
  transition: padding var(--transition);
  
}

.sidebar-action-main {
  padding: 0 16px 16px 16px; /* Ajuste o padding como desejar */
  transition: padding var(--transition);
}

.sidebar-history {
  flex: 1; /* Ocupa todo o espaço vertical restante e permite rolagem */
  overflow-y: auto;
  padding: 10px 0;
  transition: padding var(--transition);
}

.sidebar-footer {
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  transition: padding var(--transition);
}

/* --- 5. SIDEBAR: COMPONENTES INTERNOS (Botões, Textos, Ícones) --- */
.toggle-sidebar {
  background: none;
  border: none;
  color: var(--text);
  /* margin-bottom: 12px; */
  cursor: pointer;
  transition: var(--transition);
}
/* 
#btnToggleSidebar {
  margin-top: 0;
  width: 100%;
  display: flex;
  align-items: center;
  gap: 8px; Espaçamento entre ícone e texto
  transition: gap var(--transition);
  overflow: hidden;
} */

#btnNewChat {
  margin-top: 0;
  width: 100%;
  display: flex;
  align-items: center;
  gap: 8px; /* Espaçamento entre ícone e texto */
  transition: gap var(--transition);
  overflow: hidden;
}

.sidebar-home {
  background: none;
  border: 0;
  color: inherit;
  padding: 10px 16px;
  text-align: left;
  border-radius: 8px;
  cursor: pointer;
  transition: background var(--transition);
}

.sidebar-home:hover,
.sidebar-home.active {
  background: var(--card);
}

.sidebar-footer button {
  display: flex;
  align-items: center;
  gap: 8px;
  transition: gap var(--transition);
  overflow: hidden;
}

.sidebar-title {
  font-weight: 700;
  font-size: 1.15rem;
}

.btn-text {
  /* Garante que o texto não quebre a linha durante a animação */
  white-space: nowrap;

  /* Define o estado inicial */
  opacity: 1;
  max-width: 150px; /* Um valor base para a animação */

  /* A transição que você pediu, usando sua variável */
  transition: opacity var(--transition), max-width var(--transition);
}

.sidebar-action-main .btn i,
.sidebar-footer .btn i,
.chat-header .toggle-sidebar i,
.sidebar-chat-item i {
  /* Define o tamanho do ícone */
  font-size: 1.1rem;

  /* Define uma largura fixa (baseada no font-size) */
  width: 1.25em;

  /* Garante que ícones mais finos fiquem no centro do seu espaço */
  text-align: center;
  flex-shrink: 0;
}

/* --- 6. SIDEBAR: LÓGICA DE COLAPSO (REGRAS .collapsed) --- */

/* 6.1. Define a nova largura da sidebar colapsada */
.sidebar.collapsed {
  width: 90px; /* Reduz a largura */
  background: var(--bg);
}

/* --- CORREÇÃO DE ALINHAMENTO DO HEADER --- */

/* Garante que o botão de toggle perca paddings e centralize */
.sidebar.collapsed .toggle-sidebar {
  padding-left: 0 !important;
  padding-right: 0 !important;
  width: 100% !important; /* Ocupa toda a largura da sidebar (70px) */
  display: flex !important;
  justify-content: center !important; /* Centraliza o ícone horizontalmente */
}

/* Removemos padding do header container também */
.sidebar.collapsed .sidebar-header {
  padding-left: 0 !important;
  padding-right: 0 !important;
  display: flex;
  justify-content: center;
}

/* 6.2. Lógica de centralização (animando o padding) */
.sidebar.collapsed .sidebar-header,
.sidebar.collapsed .sidebar-action-main,
.sidebar.collapsed .sidebar-footer {
  /* Remove o padding de cima/baixo que não queremos animar */
  padding-top: 16px;
  padding-bottom: 16px;

  padding-left: 0 !important;
  padding-right: 0 !important;

  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Ajuste fino para o .sidebar-action-main que tinha padding diferente */
.sidebar.collapsed .sidebar-action-main {
  padding-left: 0 !important;
  padding-right: 0 !important;
  
  /* Garante que o conteúdo fique no meio */
  display: flex;
  justify-content: center;
  align-items: center;
}

/* 6.3. Lógica para esconder texto (animando opacidade e largura) */
.sidebar.collapsed .sidebar-title,
.sidebar.collapsed .btn-text {
  opacity: 0;
  max-width: 0px;
}

/* 6.4. Lógica para remover espaçamento (animando gap) */
.sidebar.collapsed .sidebar-footer button {
  gap: 0; /* Remove o espaço desnecessário */
}

.sidebar.collapsed #btnNewChat {
  /* Zera as laterais */
  padding-left: 0 !important;
  padding-right: 0 !important;
  
  /* O botão ocupa toda a largura (ex: 90px) */
  width: 100% !important;
  
  /* Centraliza o ícone no meio do botão */
  justify-content: center !important;
  
  /* Remove o espaço entre o ícone e o texto invisível */
  gap: 0 !important;
}

/* --- 7. UTILITÁRIOS E FEEDBACK --- */
.feedback {
  margin-top: 8px;
  display: flex;
  gap: 8px;
}

.btnLike,
.btnDislike {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  padding: 4px 8px;
  border-radius: 4px;
  color: var(--text);
  cursor: pointer;
  font-size: 0.8rem;
  transition: background var(--transition);
}

.btnLike:hover,
.btnDislike:hover {
  background: rgba(255, 255, 255, 0.2);
}

.meta {
  font-size: 0.75rem;
  color: var(--muted);
  margin-top: 4px;
  display: block;
}

/* --- 8. RESPONSIVO (Mobile) --- */
@media (max-width: 900px) {
  /* Sidebar - Fica oculta e é revelada com a classe .expanded */
 /* --- A. SIDEBAR (Gaveta lateral) --- */
  .sidebar {
    position: absolute;
    width: 280px;
    left: -280px; /* Escondida por padrão */
    z-index: 1000;
    height: 100%;
    transition: left var(--transition);
    background: var(--bg); /* Garante fundo sólido */
    
    /* Garante que a borda ou sombra apareça se desejar */
    box-shadow: 2px 0 10px rgba(0,0,0,0.5); 
  }

  /* Quando ativa, desliza para a tela */
  .sidebar.expanded {
    left: 0;
  }

  /* --- B. FORÇAR EXIBIÇÃO DE TEXTO E ÍCONES (Correção do Bug) --- */
  /* O uso de !important aqui é necessário para sobrescrever as regras .collapsed do desktop */

  /* 1. Restaura opacidade e largura dos textos */
  .sidebar.expanded .btn-text,
  .sidebar .btn-text {
    opacity: 1 !important;
    max-width: 100% !important;
    display: block !important;
  }

  .sidebar.expanded .sidebar-title {
    opacity: 1 !important;
    max-width: 100% !important;
  }

  /* 2. Restaura espaçamentos (padding) e gaps originais */
  .sidebar.expanded .sidebar-header,
  .sidebar.expanded .sidebar-action-main,
  .sidebar.expanded .sidebar-footer {
    padding: 16px !important;
  }

  .sidebar.expanded .sidebar-footer button,
  .sidebar.expanded #btnNewChat {
    gap: 8px !important;
  }

  /* 3. Força o Histórico a aparecer corretamente */
  .sidebar.expanded .sidebar-chat-item {
    display: flex !important;
    padding: 10px 16px !important;
    gap: 8px !important;
  }

  /* --- C. COMPOSER (Barra de Digitação) --- */
  /* Reseta totalmente a posição para centralizar na tela do celular */
  
  .composer {
    position: fixed !important;
    top: auto !important;
    bottom: 20px !important;
    
    /* Centralização Absoluta */
    left: 50% !important;
    transform: translateX(-50%) !important;
    
    width: 90% !important;
    max-width: none !important;
    
    /* Reseta margens laterais do desktop */
    margin-left: 0 !important;
    margin-right: 0 !important;
    right: auto !important;
  }

  /* Sobrescreve as regras específicas de .sidebar ~ .composer */
  .sidebar:not(.collapsed) ~ .home-main .composer,
  .sidebar.collapsed ~ .home-main .composer,
  .sidebar ~ .home-main .home-container:has(.messages:not(:empty)) .composer {
    left: 50% !important;
    transform: translateX(-50%) !important;
    margin-left: 0 !important;
    width: 90% !important;
    right: auto !important;
  }

  /* --- D. LISTA DE MENSAGENS --- */
  /* Remove o deslocamento (transform) usado no desktop */
  
  .sidebar:not(.collapsed) ~ .home-main .messages,
  .sidebar.collapsed ~ .home-main .messages {
    transform: none !important;
    margin: 0 auto !important;
    width: 100% !important;
    padding: 16px; /* Garante respiro nas laterais */
  }
}

/* --- 9. AJUSTES DE CONTEÚDO (Markdown) --- */

/* Corrige o alinhamento de listas (ul/ol) que vêm do Markdown 
  dentro dos balões de mensagem.
*/
li.msg > div:first-child ul,
li.msg > div:first-child ol {
  /* Restaura o padding esquerdo que o 'styles.css' (reset) removeu. */
  padding-left: 20px;

  /* Garante que os marcadores fiquem DENTRO do balão. */
  list-style-position: inside;

  /* Adiciona um pouco de ar (espaçamento) antes e depois das listas */
  margin-top: 10px;
  margin-bottom: 10px;
}

/* Opcional: Adiciona um pequeno espaço entre os itens da lista */
li.msg > div:first-child li {
  margin-bottom: 4px; 
}

/* --- 10. HISTÓRICO DE CHAT (SIDEBAR) --- */
    
.sidebar-chat-item {
  /* Garante que o container seja flexível */
  display: flex !important; 
  justify-content: space-between; /* Texto na esquerda, Lixeira na direita */
  align-items: center;
  padding: 10px 16px !important;
  padding-right: 8px !important; /* Espaço para o botão de lixeira */
  cursor: pointer;
  transition: background var(--transition);
}

.sidebar-chat-item:hover {
  background: var(--card); /* Ou a cor de hover do seu tema */
  border-radius: 8px; /* Se os seus botões forem arredondados */
  /* Se usar border-radius, adicione margin: 0 8px; e ajuste o padding para padding: 10px 8px; */
}

/* Área do texto/ícone do chat */
.chat-item-content {  
display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;      /* Ocupa o espaço disponível */
  min-width: 0; /* TRUQUE CRUCIAL: Permite que o container encolha */
}

.sidebar-chat-item .btn-text {
  white-space: nowrap;      /* Não quebra linha */
  overflow: hidden;         /* Esconde o que vazar */
  text-overflow: ellipsis;  /* Adiciona os "..." */
  
  /* Opcional: Efeito sombreado (fade) sutil na direita */
  /* Nota: O padrão web para "..." é apenas o text-overflow acima. 
     Se quiser um "fade" real, usa-se mask-image, mas o ellipsis é mais comum. */
  display: block;
  width: 100%;
}

/* Botão de lixeira */
.btn-delete-chat {
  background: none;
  border: none;
  color: var(--muted); /* Usa cor discreta */
  cursor: pointer;
  padding: 6px;
  border-radius: 4px;
  font-size: 0.9rem;
  opacity: 0; /* Invisível por padrão */
  transition: all 0.2s ease;
}

.btn-delete-chat:hover {
  color: #ff4d4d; /* Vermelho ao passar o mouse */
  background: rgba(255, 77, 77, 0.1);
}

/* Mostra a lixeira só quando passa o mouse no item da lista */
.sidebar-chat-item:hover .btn-delete-chat {
  opacity: 1;
}

/* --- MOBILE: Sempre mostrar a lixeira no celular (não tem hover) --- */
@media (max-width: 900px) {
  .btn-delete-chat {
    opacity: 1;
  }
}

/* --- REGRAS DE COLAPSO PARA O HISTÓRICO --- */

.sidebar.collapsed .sidebar-history {
  padding: 0; /* Remove o padding lateral */
}

.sidebar.collapsed .sidebar-chat-item {
  gap: 0;
  /* Aplica o mesmo padding de centralização dos outros botões (linha 257) */
  padding-top: 10px;
  padding-bottom: 10px;
  padding-right: 16px;
  padding-left: calc((70px - 1.375rem) / 2);
  display: none !important;
}

/* --- ESTILOS DO QUIZ (GAMIFICAÇÃO) --- */
.quiz-container {
  background: #0f1a2e;
  border: 1px solid #233556;
  border-radius: 16px;
  padding: 16px;
  margin-top: 12px;
  animation: fadeIn 0.5s ease;
}

.quiz-question {
  font-weight: 700;
  margin-bottom: 12px;
  color: var(--accent);
  font-size: 1rem;
}

.quiz-options {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.quiz-btn {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  padding: 12px;
  border-radius: 8px;
  color: var(--text);
  text-align: left;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.95rem;
}

.quiz-btn:hover {
  background: rgba(255, 255, 255, 0.1);
}

/* Estados de Resposta */
.quiz-btn.correct {
  background: rgba(20, 195, 142, 0.2) !important;
  border-color: #14c38e !important;
  color: #14c38e !important;
}

.quiz-btn.wrong {
  background: rgba(255, 77, 77, 0.2) !important;
  border-color: #ff4d4d !important;
  color: #ff4d4d !important;
}

.quiz-explanation {
  margin-top: 12px;
  font-size: 0.9rem;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 8px;
  border-left: 3px solid var(--accent);
}